#! /usr/bin/perl
#

use Data::Dumper;
use Getopt::Std;

BEGIN {
        push (@INC,"../modules");
}

use ipmanage_config;
use sql;
use ipmanage;

my $now=&date_and_time_stamp;
$new_hosts_file="/tmp/hosts." . $now;
$new_hosts_file=~s/\s+/_/g;

if ($ARGV[0] ne '') {
	$new_hosts_file=$ARGV[0];
}

my $hostname=`hostname`; chomp $hostname;

open(HF,">$new_hosts_file") or die "cannot open file $new_hosts_file: $!\n";

my $sql_cmd="SELECT ip,hostname,aliases,comment FROM ip_hosts WHERE hostname != '' ORDER by ip;";
my @host_array=&select_array($sql_cmd);

print HF "#" x 80, "\n"; 
print HF "# This file is generated by $INSTALLDIR/bin/ipmanage_write_hosts.pl\n";
print HF "# Please use the tools in $INSTALLDIR/bin\n"; 
print HF "# to change entries in the hosts file\n";
print HF "# or use the GUI http://$hostname/ipmanage/cgi-bin/ipmanage_network.pl\n";
print HF "#" x 80, "\n"; 


foreach my $i (@host_array) {
	my ($ip,$hostname,$aliases,$comment)=@$i;
	$ip_dotted=&convert_dec2ip($ip);
	printf(HF "%-15s %-25s %-25s # %s\n",$ip_dotted,$hostname,$aliases,$comment);
}
close HF;
print STDERR "File is in: ", $new_hosts_file, "\n";
